version: '3.8'

services:
  logoarr:
    build: .
    container_name: logoarr
    ports:
      - "5000:5000"
    environment:
      - TMDB_API_KEY=${TMDB_API_KEY}
      - MOVIE_FOLDERS=/movies,/kids-movies
      - TV_FOLDERS=/tv,/kids-tv
      - SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL:-}
    volumes:
      # Local storage for mappings
      - ./tmdb_directory_mapping.json:/app/tmdb_directory_mapping.json
      # CIFS/SMB volumes (managed by Docker)
      - movies:/movies
      - kids-movies:/kids-movies
      - tv:/tv
      - kids-tv:/kids-tv
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python3", "-c", "import os; os.listdir('/movies')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

volumes:
  movies:
    driver: local
    driver_opts:
      type: cifs
      o: "username=${SMB_USERNAME},password=${SMB_PASSWORD},vers=3.0,file_mode=0777,dir_mode=0777,iocharset=utf8,cache=loose,actimeo=60,_netdev"
      device: "//${NAS_IP}/movies"

  kids-movies:
    driver: local
    driver_opts:
      type: cifs
      o: "username=${SMB_USERNAME},password=${SMB_PASSWORD},vers=3.0,file_mode=0777,dir_mode=0777,iocharset=utf8,cache=loose,actimeo=60,_netdev"
      device: "//${NAS_IP}/kids-movies"

  tv:
    driver: local
    driver_opts:
      type: cifs
      o: "username=${SMB_USERNAME},password=${SMB_PASSWORD},vers=3.0,file_mode=0777,dir_mode=0777,iocharset=utf8,cache=loose,actimeo=60,_netdev"
      device: "//${NAS_IP}/tv"

  kids-tv:
    driver: local
    driver_opts:
      type: cifs
      o: "username=${SMB_USERNAME},password=${SMB_PASSWORD},vers=3.0,file_mode=0777,dir_mode=0777,iocharset=utf8,cache=loose,actimeo=60,_netdev"
      device: "//${NAS_IP}/kids-tv"
